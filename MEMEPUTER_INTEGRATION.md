# Memeputer AI Agent Integration Guide

## Overview
The Memeputer AI agent is responsible for generating high-quality sticker blueprints based on templates and project context. The bot sends requests to the agent, which returns detailed animation specifications.

## Current Implementation

### Request Flow
1. User provides base image + project context + template
2. Bot calls `memeputerClient.getBlueprint(template, projectContext)`
3. Request sent to: `POST {MEMEPUTER_AGENT_URL}/generate`

### Request Structure
```typescript
{
  template_id: "GM", // Template: GM, GN, LFG, HIGHER, HODL, WAGMI, NGMI, SER, REKT, ALPHA
  project_context: "memeputer that is creating sticker packs, funny, innovative",
  user_prompt: undefined, // Optional custom instructions
  constraints: {
    duration_max_sec: 3.0,
    fps_max: 30,
    transparent_background: true,
    big_readable_text: true,
    loop_friendly: true,
    target_size_kb: 256
  }
}
```

### Expected Response
```typescript
{
  blueprint: {
    duration_sec: 2.6,
    fps: 20,
    loop: true,
    text: {
      value: "GM",
      subvalue: "$JOBS",
      placement: "top" | "center" | "bottom",
      stroke: true
    },
    motion: {
      type: "bounce" | "shake" | "none",
      amplitude_px: 10,
      period_sec: 1.3
    },
    face: {
      blink: true,
      blink_every_sec: 2.0
    },
    effects: {
      sparkles: true,
      sparkle_count: 6,
      stars: true
    }
  }
}
```

## Quality Issues & Solutions

### Current Problems
1. **Fallback to defaults**: If Memeputer agent fails or isn't configured, bot uses basic default blueprints
2. **Limited context**: Only sending template + project context, not base image analysis
3. **No error visibility**: Hard to tell if agent is being called or failing silently
4. **Basic blueprints**: Default blueprints are very simple and don't adapt to project context

### Recommended Improvements

#### 1. Enhanced Logging (✅ Implemented)
- Added detailed logging to see if Memeputer is being called
- Logs request details, response status, and errors
- Shows when fallback blueprints are used

#### 2. Base Image Analysis (Future)
The Memeputer agent could receive:
- Base image description (generated by vision AI)
- Color palette extraction
- Style analysis (cartoon, realistic, minimalist, etc.)
- Character/mascot detection

**Example enhanced request:**
```typescript
{
  template_id: "GM",
  project_context: "memeputer that is creating sticker packs, funny, innovative",
  base_image_description: "A retro computer setup with stickers, tech-themed, colorful",
  style_preferences: "retro, tech, playful",
  constraints: { ... }
}
```

#### 3. Richer Blueprint Structure (Future)
Allow Memeputer to specify:
- Custom color schemes matching project
- More sophisticated motion patterns
- Advanced effects (particles, gradients, etc.)
- Text styling (fonts, colors, animations)
- Layering and composition hints

#### 4. Multi-Template Intelligence (Future)
When user requests multiple templates (e.g., "GM, GN, LFG, WAGMI, ALPHA"):
- Memeputer could generate variations that work together as a pack
- Consistent style across templates
- Complementary effects and colors

## Configuration

### Environment Variables
```bash
MEMEPUTER_AGENT_URL=https://your-memeputer-api.com
MEMEPUTER_AGENT_SECRET=your-secret-key
```

### Verification
Check logs for:
- `[Memeputer] Requesting blueprint from AI agent` - Agent is being called
- `[Memeputer] ✅ Using AI-generated blueprint` - Agent returned a blueprint
- `[Memeputer] ❌ Request failed` - Agent call failed
- `[Memeputer] Using fallback blueprint` - Using defaults (quality will be lower)

## Memeputer Agent Requirements

The Memeputer agent should:
1. **Understand project context**: Use context to adapt blueprint (colors, style, effects)
2. **Generate creative variations**: Not just return template defaults
3. **Respect constraints**: Ensure output meets Telegram requirements
4. **Return detailed blueprints**: Provide all animation parameters
5. **Handle errors gracefully**: Return error messages if generation fails

## Testing

To verify Memeputer is working:
1. Check bot logs for `[Memeputer]` entries
2. Look for `✅ Using AI-generated blueprint` messages
3. Compare quality: AI-generated should be more creative than defaults
4. Test with different project contexts to see adaptation

## Troubleshooting

### Agent Not Being Called
- Check `MEMEPUTER_AGENT_URL` is set in `.env`
- Check `MEMEPUTER_AGENT_SECRET` is set
- Look for `Client not configured` warning in logs

### Agent Returns Errors
- Check agent logs for generation failures
- Verify agent API endpoint is correct
- Check authentication (Bearer token)
- Verify request format matches agent expectations

### Low Quality Output
- Ensure agent is actually being called (check logs)
- Verify agent is using project context in generation
- Consider enhancing request with more context (image description, style hints)
- Check if agent needs more detailed instructions

